<!doctype html>
<html>
  <head>
    <title>ClueLess</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="node_modules/custombox/src/css/custombox.css">
    <script src="//cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="/node_modules/custombox/src/js/custombox.js"></script>
    <script src="Player.js"></script>
  </head>
  <body>
    <div id="loginModal" class="flex-container">
    <form id="loginForm" action="">
      <input id="nameInput" required/><br>
      <select id="characterSelect" name="character">
        <option value="Professor Schappelle">Professor Schappelle</option>
        <option value="Professor Demasco">Professor Demasco</option>
        <option value="Professor Garonzik">Professor Garonzik</option>
        <option value="Mr. Brock">Mr. Brock</option>
        <option value="Dean Schlesinger">Dean Schlesinger</option>
      </select><br>
      <input type="submit" value="Login">
    </form>
    </div>

    <div id="mainContainer">
      <div id="gameBoardContainer" class="flex-container">
        <div id="gameColumn1" class="gameBoardColumn">
        <canvas id="gameBoard1-1" class="room"></canvas>
        <canvas id="gameBoard2-1"></canvas>
        <canvas id="gameBoard3-1" class="room"></canvas>
        <canvas id="gameBoard4-1"></canvas>
        <canvas id="gameBoard5-1" class="room"></canvas>
        </div>
        <div id="gameColumn2" class="gameBoardColumn">
        <canvas id="gameBoard1-2"></canvas>
        <canvas id="gameBoard2-2"></canvas>
        <canvas id="gameBoard3-2"></canvas>
        <canvas id="gameBoard4-2"></canvas>
        <canvas id="gameBoard5-2"></canvas>
        </div>
        <div id="gameColumn3" class="gameBoardColumn">
        <canvas id="gameBoard1-3" class="room"></canvas>
        <canvas id="gameBoard2-3"></canvas>
        <canvas id="gameBoard3-3" class="room"></canvas>
        <canvas id="gameBoard4-3"></canvas>
        <canvas id="gameBoard5-3" class="room"></canvas>
        </div>
        <div id="gameColumn4" class="gameBoardColumn">
        <canvas id="gameBoard1-4"></canvas>
        <canvas id="gameBoard2-4"></canvas>
        <canvas id="gameBoard3-4"></canvas>
        <canvas id="gameBoard4-4"></canvas>
        <canvas id="gameBoard5-4"></canvas>
        </div>
        <div id="gameColumn5" class="gameBoardColumn">
        <canvas id="gameBoard1-5" class="room"></canvas>
        <canvas id="gameBoard2-5"></canvas>
        <canvas id="gameBoard3-5" class="room"></canvas>
        <canvas id="gameBoard4-5"></canvas>
        <canvas id="gameBoard5-5" class="room"></canvas>
        </div>
      </div>
      <div id="chatContainer"  class="flex-container">
      <ul id="messages"></ul>
      <form id="chatForm" action="">
        <input id="messageInput" autocomplete="off" required/>
        <button class="submitMessage">Send</button>
      </form>
      </div>
      <br syle="lineBreak"/>
    </div>
    <script>
    //Instantiate the player object
    var player = Player.getPlayer();

    //Execute when the document and jQuery are ready
    $(function(){
      //Instantiate the socket object
      var socket = io();

      console.log(player);

      initiateLogin();
      //initiateGameBoard();
    
      /**
      *Handles submit of the chat form
      **/
      $('form#chatForm').submit(function(){
        socket.emit('message', $('#messageInput').val());
        $('#messageInput').val('');
        return false;
      });

      /**
      *Handles submit of login form
      **/
      $('form#loginForm').submit(function(){
        socket.emit('login', $('input#nameInput').val(), $('select#characterSelect option:selected').val());
        //send player as callback
        Custombox.close();
        return false;
      });

      /**
      *Socket listener for server-sent event chatMessage
      **/
      socket.on('chatMessage', function(player, msg){
        $('#messages').append($('<li>').text(player.name + ' : ' + msg));
        window.scrollTo(0,document.body.scrollHeight);
      });

      /**
      *Socket listener for server-sent event playerLogin
      **/
      socket.on('playerLogin', function(name, character){
        $('#loginModal').addClass('noDisplay');
        $('#messages').append($('<li>').text(name + " has logged in as " + character));
        window.scrollTo(0, document.body.scrollHeight);
        $('div#gameBoardContainer').prepend($('<character class="draggable">').text(character));
        setDraggableCharacters();
      });

      /**
      *Socket listener for server-sent event updateCharacterPosition
      **/

    });

    /**
    *Creates the login screen and displays it to the user upon startup
    **/
    function initiateLogin() {
      if(!player || !Player.getPlayer() || !Player.getPlayer().playerId){
        Custombox.open({
            target: '#loginModal',
            effect: 'fadein',
            escKey: false,
            overlayClose: false,
        });
      }
    }

    /**
    *Allow the current player to drag their character
    **/
    function setDraggableCharacters() {
      $( ".draggable" ).draggable({
        containment: "#gameBoardContainer",
        snap: "canvas.room",
        snapMode: "inner",
        revert: true,
        handle: ""
      });
    }

    /**
    *Create the Game Board
    Deprecated - remove
    function initiateGameBoard () {
      var canvas = document.getElementById('gameBoard');
      var context = canvas.getContext('2d');
      resizeGameBoard();
    }

    function resizeGameBoard(){
      //Get the canvas and context 
      var c = $('canvas[id*=gameBoard]');
      var ct = c.get(0).getContext('2d');
      var container = $('div#gameBoardContainer');

      //Run function for each gamBoard canvas when browser resizes
      $.each(c, function(i, val){
        $(window).resize((function(){ 
        c.attr('width', $(container).width() ); //max width
        c.attr('height', $(container).height() ); //max height
        })());
      });
    }*/
    </script>
  </body>
</html>